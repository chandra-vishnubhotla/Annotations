## *Docker-Desktop*
<base target="_blank" />
<style>
    div, p { text-align: justify; }
    th { display: none; }
</style>

+ Download and install [Docker-Desktop](https://www.docker.com/products/docker-desktop) (Enable WSL 2)
+ Download and install [JQ Command-line](https://jqlang.org/download/)
```
docker --version
docker --help
powershell -Command "wsl --install"
wsl.exe -d Ubuntu
grep --version
```
+ Docker [Documentation](https://docs.docker.com/get-started/)

---

### *Docker Images*
A snapshot of a fully configured system, ready to be executed
```
docker pull <image_name>
docker images
docker image inspect <image_name> --format json | jq .
docker rmi --force <image_name>
docker image prune --all --force
```

### *Docker Containers*
Runnable instance of a docker image, isolated from the host
```
docker run -it --name=<container_name> <image_name>
docker ps
docker container inspect <container_name> --format json | jq .
docker rm --force --volumes <container_name>
docker container prune --force
```

### *Create an Image from a Container*
```
docker pull ubuntu:latest
docker run -it --name=ubuntu-container ubuntu:latest
```
Once the image has been downloaded and started, you should see a new prompt like *```root@d8c5ca119fcd:/#```*
```
apt update && apt install -y nodejs
node --eval="console.log('Hello world')"
```
Run the following command in a new terminal
```
docker commit --message "Add node.js" ubuntu-container node-js
docker image history node-js
docker rm --force ubuntu-container
docker rmi --force ubuntu:latest
docker run --rm --name=temp node-js node -e "console.log('Hello again!')"
```
Credentials: *```vcs.deepak@rediffmail.com```* | ~~*```$avitha@79```*~~

### *Docker Volumes*
A mechanism for persisting data generated by and used by docker containers and services
```
docker volume ls
docker volume inspect <volume_name> --format json | jq .
docker volume rm --force <volume_name>
docker volume prune --all --force
```

### *Docker Networks*
Containers ability to connect and communicate with each other, or to non-docker workloads
```
docker network ls
docker network inspect <network_name> --format json | jq .
docker network rm --force <network_name>
docker network prune --force
```
To remove all unused or stopped containers, images, networks and volumes
```
docker system prune --all --force --volumes
docker buildx prune --all --force
```

---

### *Dockerfile*
A set of instructions telling docker how to build and run our app
|      |      |
| :--- | :--- |
| **```ADD```**         | Add local or remote files and directories                  |
| **```ARG```**         | Use build-time variables                                   |
| **```CMD```**         | Specify default commands                                   |
| **```COPY```**        | Copy files and directories                                 |
| **```ENTRYPOINT```**  | Specify default executable                                 |
| **```ENV```**         | Set environment variables                                  |
| **```EXPOSE```**      | Describe which ports your application is listening on      |
| **```FROM```**        | Create a new build stage from a base image                 |
| **```HEALTHCHECK```** | Check a container's health on startup                      |
| **```LABEL```**       | Add metadata to an image                                   |
| **```MAINTAINER```**  | Specify the author of an image                             |
| **```ONBUILD```**     | Specify instructions for when the image is used in a build |
| **```RUN```**         | Execute build commands                                     |
| **```SHELL```**       | Set the default shell of an image                          |
| **```STOPSIGNAL```**  | Specify the system call signal for exiting a container     |
| **```USER```**        | Set user and group ID                                      |
| **```VOLUME```**      | Create volume mounts                                       |
| **```WORKDIR```**     | Change working directory                                   |

Create a file named *```Dockerfile```* in the project folder. ***Note:** Dockerfile has no file extension*
```
FROM node:20-alpine
WORKDIR /app
COPY . .
RUN yarn install --production
EXPOSE 3000
CMD ["node", "./src/index.js"]
```
Run the following command in a new terminal
```
docker build --tag node-app:1.0 .
docker run --detach --name node-container --publish 80:8089 node-app:1.0
docker logs --tail 50 --until "45m" node-container
```

---

### *Docker Compose*
Create a file named *```docker-compose.yml```* in the project folder
```
services:
    node:
        image: "node:8"
        user: "node"
        working_dir:/home/node/app
        environment:
            - NODE_ENV=production
        volumes:
            - ./:/home/node/app
        expose:
            - "8081"
        ports:
            - "8001:8001"
        command: "npm start"
```
Run the following command in a new terminal
```
docker compose up --build --detach
docker exec -it <container_name> <commands>
docker compose down --remove-orphans --volumes

mkdir "d:\docker\data"
icacls "d:\docker\data" /grant Everyone:(OI)(CI)F /T
```

---

### *[dotnet](https://hub.docker.com/r/microsoft/dotnet) docker image*
```
docker pull mcr.microsoft.com/dotnet/sdk:9.0
docker run --entrypoint sh -it --rm --volume "%cd%:/app" mcr.microsoft.com/dotnet/sdk:9.0
#> cd app && pwd
#> dotnet --version
```

### *[ngrok](https://hub.docker.com/r/ngrok/ngrok) docker image*
```
docker pull ngrok/ngrok
docker run -it -e NGROK_AUTHTOKEN=1S6vGJ6hXxgQULKnIF5ACd92oLS_bc7k8uwr8vnUS2KPGgf4 ngrok/ngrok http 80
```

### *[node.js](https://hub.docker.com/_/node) docker image*
```
docker pull node:22-alpine
docker run --entrypoint sh -it --rm --volume "%cd%:/app" node:20-alpine
#> cd app && pwd
#> node --version
```

### *[python](https://hub.docker.com/_/python) docker image*
```
docker pull python:alpine
docker run -it --rm --volume "%cd%:/app" python:alpine python "/app/script.py"
```

### *[ubuntu](https://hub.docker.com/_/ubuntu) docker image*
```
docker pull ubuntu:latest
docker run -it --rm --volume "%cd%:/app" ubuntu:latest bash
#> cd app && pwd
#> apt upgrade
```

---

### *[mongodb](https://hub.docker.com/_/mongo) docker image*
```
docker pull mongo:latest
docker network create mongo-network
docker container remove --force --volumes mongo-server

docker run -it --rm mongo:latest bash (or)
docker run --detach ^
    --name mongo-server ^
    --network mongo-network ^
    --publish 27071:27071 ^
    --volume "D:/docker/data":/data ^
    --env MONGO_INITDB_ROOT_USERNAME=root ^
    --env MONGO_INITDB_ROOT_PASSWORD=secret ^
    mongo:latest

docker inspect --format json mongo-server | jq .

docker exec -it mongo-server bash (or)
docker exec -it mongo-server mongosh ^
    --host localhost ^
    --username root ^
    --password secret ^
    --authenticationDatabase admin ^
    vemasoft

docker container remove --force --volumes mongo-server
docker network rmeove mongo-network --formce 
docker image remove --force mongo:latest
```

### *[mongo-express](https://hub.docker.com/_/mongo-express) docker image*
```
docker pull mongo-express:latest
docker container remove --force --volumes mongo-express

docker run --detach ^
    --name mongo-express ^
    --network mongo-network ^
    --publish 8081:8081 ^
    --env ME_CONFIG_BASICAUTH_ENABLED=true ^
    --env ME_CONFIG_MONGODB_URL="mongodb://root:secret@mongo-server:27017/" ^
    --env ME_CONFIG_BASICAUTH_USERNAME=admin ^
    --env ME_CONFIG_BASICAUTH_PASSWORD=secret ^
    mongo-express:latest

docker inspect --format json mongo-express | jq .
docker image remove --force mongo-express:latest
docker network remove --force mongo-network
docker system prune --all --force --volumes
```

### *docker-compose.yml for mongodb & mongo-express*
```
name: mongo
services:
    mongo-server:
        image: mongo:latest
        container_name: mongo-server
        environment:
            MONGO_INITDB_ROOT_USERNAME: root
            MONGO_INITDB_ROOT_PASSWORD: secret
        networks:
            - mongo-network
        ports:
            - "27017:27017"
        restart: unless-stopped
        volumes:
            - ./data:/data
    mongo-express:
        image: mongo-express:latest
        container_name: mongo-express
        depends_on:
            - mongo-server
        environment:
            ME_CONFIG_BASICAUTH_USERNAME: admin
            ME_CONFIG_BASICAUTH_PASSWORD: secret
            ME_CONFIG_MONGODB_URL: mongodb://root:secret@mongo-server:27017/
        networks:
            - mongo-network
        ports:
            - "8081:8081"
        restart: on-failure:5
networks:
    mongo-network:
```

---

### *[MS-SQL Server](https://hub.docker.com/r/microsoft/mssql-server) docker images*
```
docker pull mcr.microsoft.com/mssql/server:2022-latest
docker network create mssql-network
docker container stop mssql-server
docker container remove --force --volumes mssql-server

docker run -it --rm mcr.microsoft.com/mssql/server:2022-latest bash (or)
docker run --detach ^
    --name mssql-server ^
    --network mssql-network ^
    --publish 1433:1433 ^
    --volume "d:\docker\data":/var/opt/mssql ^
    --env ACCEPT_EULA=Y ^
    --env "MSSQL_SA_PASSWORD=Pwd&1234" ^
    mcr.microsoft.com/mssql/server:2022-latest

docker inspect --format json mssql-server | jq .

# install mssql-tools manually on mssql-container
docker exec -it -u root mssql-server /bin/bash

# you should see a new prompt like 'root@d8c5ca119fcd:/#'
apt-get update
apt-get install -y curl gnupg
curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list > /etc/apt/sources.list.d/msprod.list
apt-get update
apt-get install mssql-tools unixodbc-dev
exit

docker exec -it mssql-server /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P "Pwd&1234"
docker container commit -m "mssql-tools" mssql-server mssql-server:tools
docker image remove --force mcr.microsoft.com/mssql/server:2022-latest
```

### *[MS-SQL Server Tools](https://hub.docker.com/r/microsoft/mssql-tools) docker images*
```
docker pull mcr.microsoft.com/mssql-tools:latest
docker container stop mssql-tools
docker container remove --force --volumes mssql-tools
docker run --name mssql-tools -it --link mssql-server --rm mcr.microsoft.com/mssql-tools:latest
docker exec -it -u root mssql-tools /bin/bash
docker image remove --force mcr.microsoft.com/mssql-tools:latest

docker network remove --force mssql-network
docker system prune --all --force --volumes
```

### *docker-compose.yml for MS-SQL Server & Tools*
```
name: mssql
services:
    mssql-server:
        image: mcr.microsoft.com/mssql/server:2019-latest
        container_name: mssql-server
        environment:
            - ACCEPT_EULA=Y
            - SA_PASSWORD=Pwd&2025
            - MSSQL_PID=Developer
        ports:
            - "1433:1433"
        volumes:
            - ./data:/var/opt/mssql/data
            - ./entry-point.sh:/entry-point.sh
            - ./entry-point.sql:/entry-point.sql
        networks:
            - mssql-network
        entrypoint: [
            "/bin/bash",
            "/entry-point.sh"
        ]
        command: bash -c "chmod +x /entry-point.sh && /entry-point.sh"
    mssql-tools:
        image: mcr.microsoft.com/mssql-tools
        container_name: mssql-tools
        depends_on:
            - mssql-server
        entrypoint: [
            "sleep",
            "infinity"
        ]
        networks:
            - mssql-network
networks:
    mssql-network:
        driver: bridge
```

---
